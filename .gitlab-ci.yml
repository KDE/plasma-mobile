# SPDX-FileCopyrightText: None
# SPDX-License-Identifier: CC0-1.0

include:
  - project: sysadmin/ci-utilities
    file:
      - /gitlab-templates/reuse-lint.yml
      - /gitlab-templates/linux-qt6.yml
      - /gitlab-templates/alpine-qt6.yml
      - /gitlab-templates/xml-lint.yml
      - /gitlab-templates/yaml-lint.yml

posix-script-compliance:
  image:
    name: debian:latest
    entrypoint: [""]
  tags:
    - Linux
  stage: build
  script:
    - apt-get update
    - apt-get -y install shellcheck
    - shellcheck -x -s sh bin/startplasmamobile.in
    - shellcheck -x -s sh bin/startplasmamobile.in
    - shellcheck -x --exclude=1091 -s sh bin/startplasmamobile-dev.sh.cmake # ignore error from file not existing (given by cmake)

.remote-builder:
  when: never
  image:
    name: espidev/alpine-remote-builder-base:latest
    entrypoint: [""]
  tags:
    - alpine-remote-builder
  stage: build
  script:
    - >
      alpine-remote-builder \
        --generate-key \
        --apkbuild-config /home/builder/apkbuilds/nightly/plasma-mobile.yml \
        --package-name plasma-mobile \
        --local-repo-path $CI_PROJECT_DIR
    - mkdir packages
    - cp -r /packages/* ./packages # artifacts must be in project folder
  artifacts:
    paths:
      - ./packages

remote-builder-amd64:
  extends: .remote-builder
  # when: manual
  # tags:
    # - alpine-remote-builder-amd64

# remote-builder-arm64:
#   extends: .remote-builder
#   when: manual
#   tags:
#     - alpine-remote-builder-arm64